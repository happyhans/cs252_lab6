<!DOCTYPE html>
<html>
    <head>
        <title>CS252</title>
        <style type="text/css">
            #demoCanvas {
                float: left;
            }
            #editor {
                height: 500px;
                width: 500px;
            }
        </style>
    </head>
    <body onload="main();">
        
        <canvas id="demoCanvas" width="500" height="500"></canvas>
        <div id="editor"></div>
        <button id="run">Run!</button>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/ace.js"></script>
        <script>
            var editor = ace.edit("editor");
            editor.setTheme("ace/theme/monokai");
            editor.getSession().setMode("ace/mode/javascript");
        </script>
        
        <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
        <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.js"></script>
        <script src="https://code.createjs.com/tweenjs-0.6.2.min.js"></script>
        <script>
            //Graph Displaying variables
            var  stage = new createjs.Stage("demoCanvas");
            var map = new createjs.Shape();
            var circle = new createjs.Shape();
            var circle_goal = new createjs.Shape();

            //Graph variables
            var d_map;
            var circle_2d_position;
            var goal_2d_position;

            //Game settings variables


            function main(){
                drawInitialMap();

                //Game loop
                 //Read the text editor and execute user's inputs
                 //Update positions and the map
                 //Check win condition


                /*createjs.Tween.get(circle, { loop: true })
                    .to({ x: 400 }, 1000)
                    .to({ y: 175 }, 500)
                    .to({ y: 225 }, 100)
                    .to({ y: 200 }, 500)
                    .to({ x: 100 }, 800);
                createjs.Ticker.setFPS(60);
                createjs.Ticker.addEventListener("tick", stage);*/
            }
            //Graph methods
            function drawInitialMap(){
                //Initalize map array

                d_map = Array(10);
                for (var i = 0; i < 10; i++)
                    d_map[i] = new Array(10);


                for (var i = 0; i < 10; i++)
                    for (var j = 0; j < 10; j++)
                        d_map[i][j] = 0;
                //Draw background
                map.graphics.beginFill("LightGreen");
                map.graphics.setStrokeStyle(1);
                map.graphics.beginStroke("#000001");
                for (var i = 0; i < 10; i++) {
                    for (var j = 0; j < 10; j++) {
                        map.graphics.drawRect(i*50,j*50,50,50);        
                    }
                }
                stage.addChild(map);
                stage.update();
                 //Randonmize start and goal positions
                circle_2d_position = {
                    x:getRandomInt(0,9),
                    y:getRandomInt(0,9)
                }

                goal_2d_position = {
                    x:getRandomInt(0,9),
                    y:getRandomInt(0,9)
                }

                d_map[circle_2d_position.x][circle_2d_position.y] = 1;
                d_map[goal_2d_position.x][goal_2d_position.y] = 2;                

                //Make sure goal and start never have a same position
                while (circle_2d_position.x == goal_2d_position.x && circle_2d_position.y == goal_2d_position.y) {
                    goal_2d_position = {
                        x:getRandomInt(0,9),
                        y:getRandomInt(0,9)
                    }
                }
                 //Draw start and goal 
                circle.graphics.beginFill("DeepSkyBlue").drawCircle(0, 10, 10);
                circle.x = circle_2d_position.x*50 + 25;
                circle.y = circle_2d_position.y*50 + 25;
                stage.addChild(circle);
                stage.update();

                circle_goal.graphics.beginFill("Orange").drawCircle(0, 10, 10);
                circle_goal.x = goal_2d_position.x*50 + 25;
                circle_goal.y = goal_2d_position.y*50 + 25;
                stage.addChild(circle_goal);
                stage.update();

                //Randomize obstacles
                var count = 0;
                while (count < 30) {
                    console.log("here\n");
                    var x = getRandomInt(0,9);
                    var y = getRandomInt(0,9);
                    if (d_map[x][y] == 0) {
                        var obstacle_type = getRandomInt(0,1);
                        if (obstacle_type == 0) {
                            d_map[x][y] = 3;
                            var o_circle = new createjs.Shape();
                            o_circle.graphics.beginFill("Black").drawCircle(0, 10, 10);
                            o_circle.x = x*50 + 25;
                            o_circle.y = y*50 + 25;
                            stage.addChild(o_circle);
                            stage.update();
                        }
                        else {
                            d_map[x][y] = 4;
                            var o_circle = new createjs.Shape();
                            o_circle.graphics.beginFill("Red").drawCircle(0, 10, 10);
                            o_circle.x = x*50 + 25;
                            o_circle.y = y*50 + 25;
                            stage.addChild(o_circle);
                            stage.update();
                        }
                        count = count + 1;
                    }
                }

                //Draw obstacles
               
                
               

            }
            //Game loop execution methods
            function winCondition() {

            }

            //In-game play methods
            function moveUp() {

            }

            function moveDown() {

            }
            function moveLeft() {

            }
            function moveRight() {

            }

            //Ultility method
            function getRandomInt(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            } 
        </script>
    </body>
</html>